<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">
    <h:head>
        <title>Manage Books</title>
    </h:head>
    <h:body>
    <h:outputStylesheet>
        .even-row {
            background-color: #FCFFFE;
        }
 
        .odd-row {
            background-color: #ECF3FE;
        }
 
        .even-row:hover,
        .odd-row:hover {
            background-color: #FFEBDA;
        }
    </h:outputStylesheet>
    
   
   
<h:form id="form" prependId="false">
<rich:toolbar height="40" itemSeparator="grid" width="100%">
  <rich:toolbarGroup >

<h:commandButton value="Filter" >
<f:ajax event="click" listener="#{manageBookBean.searchAction()}"  execute="@form" render="@form"></f:ajax>
</h:commandButton>
<h:commandButton value="Clean filters" > 
<f:ajax event="click" listener="#{manageBookBean.cleanFilters()}" render="@form"></f:ajax>
</h:commandButton>
<h:commandButton value="Delete selected" > 
<f:ajax event="click" listener="#{manageBookBean.deleteListBooks()}" render="@form"></f:ajax>
</h:commandButton>
</rich:toolbarGroup>
</rich:toolbar>

	
		<ui:param name="bean" value="#{manageBookBean}" />

 <!--The sortable datatable-->
		<rich:dataTable  keepSaved="true" id="booksTable1" value="#{manageBookBean.books}" var="book" rows="#{manageBookBean.rowsPerPage}" 
		rowClasses="odd-row, even-row" style="width:100%" binding="#{table}" styleClass="stable">
<!-- checkBox column -->	
	<rich:column>
		<f:facet name="header">
		<h:selectBooleanCheckbox value="#{manageBookBean.selectAll}" >
		<f:ajax  event="change" listener="#{manageBookBean.selectAllAction()}" render="@form"></f:ajax>
		</h:selectBooleanCheckbox>
		</f:facet>
			<h:selectBooleanCheckbox  value="#{book.selected}"> 
			<f:ajax ></f:ajax>
			</h:selectBooleanCheckbox>
	</rich:column>
			
<!-- bookName Column -->		

 	<rich:column id="bookName" sortBy="#{columnName}" sortOrder="#{manageBookBean.sortOrders[columnName]}" sortType="custom">
 	<ui:param name="columnName" value="#{manageBookBean.bookWrapperUI.bookName}" />
 	
        <f:facet name="header">
            <h:outputLabel value="#{columnName}" />
            <h:commandLink >
                #{manageBookBean.sortOrders[columnName]}
                <f:ajax event="click" listener="#{manageBookBean.toggleSort(columnName)}" execute="@form" render="@form"></f:ajax>
            </h:commandLink>
             <br />
            <h:inputText  value="#{manageBookBean.filterValues[columnName]}" >
            <f:ajax event="change" ></f:ajax>
            </h:inputText>
        </f:facet>
		<h:link value="#{book.bookName}" outcome="bookDetails">
			<f:param name="id" value="#{book.idBook}"></f:param>
		</h:link>
	</rich:column>
	
<!-- Publisher column -->    
   <ui:include src="regularColumn.xhtml">
		<ui:param name="bean" value="#{manageBookBean}" />
		<ui:param name="id" value="publisher" />
		<ui:param name="columnName" value="#{manageBookBean.bookWrapperUI.publisher}" />
		<ui:param name="property" value="#{book.publisher}" />
   </ui:include>
   
 <!-- ISBN Column --> 
 	<ui:include src="regularColumn.xhtml">
 	<ui:param name="id" value="isbn" />
		<ui:param name="bean" value="#{manageBookBean}" />
		<ui:param name="columnName" value="#{manageBookBean.bookWrapperUI.isbn}" />
		<ui:param name="property" value="#{book.isbn}" />
   </ui:include>

<!-- yearPublished column -->
   <ui:include src="regularColumn.xhtml">
   <ui:param name="id" value="yearPublished" />
		<ui:param name="bean" value="#{manageBookBean}" />
		<ui:param name="columnName" value="#{manageBookBean.bookWrapperUI.yearPublished}" />
		<ui:param name="property" value="#{book.yearPublished}" />
   </ui:include>
   
 <!-- Rating Column -->
 	<ui:include src="regularColumn.xhtml">
 	<ui:param name="id" value="rating" />
		<ui:param name="bean" value="#{manageBookBean}" />
		<ui:param name="columnName" value="#{manageBookBean.bookWrapperUI.rating}" />
	<ui:param name="property" value="#{book.rating}" />
   </ui:include>
   		
 <!-- Author Column -->
	<rich:column id="authors" sortBy="#{columnName}" sortOrder="#{manageBookBean.sortOrders[columnName]}" filterValue="#{manageBookBean.filterValues[property]}"
                 filterExpression="#{property}" filterType="custom" sortType="custom">
	<ui:param name="columnName" value="#{manageBookBean.bookWrapperUI.authors}" />
        <f:facet name="header">
        	<h:outputText value="#{columnName}" />
            <h:commandLink >
                #{manageBookBean.sortOrders[columnName]}
                <f:ajax event="click" listener="#{manageBookBean.toggleSort(columnName)}" execute="@form" render="@form"></f:ajax>
            </h:commandLink>
            <br />
            <h:inputText value="#{manageBookBean.filterValues[columnName]}" >
             <f:ajax event="change"></f:ajax>
            </h:inputText>
        </f:facet>
        
        <rich:list value="#{book.bookAuthors}" id="manageBookAuthors" var="author" type="#{listBean.listType}">
        <h:link value="#{author.secondName} #{author.firstName}" outcome="authorDetail">
        	<f:param name="id" value="#{author.idauthor}"></f:param>
		</h:link>
    	</rich:list>
    </rich:column>
    
    <rich:column>
    <f:facet name="header">
        	<h:outputText value="Edit / delete row" />
</f:facet>
<a4j:commandButton value="DEL" styleClass="no-decor" execute="@this" render="@none"
                    oncomplete="#{rich:component('confirmPane')}.show()">
                    <a4j:param value="#{book.idBook}" assignTo="#{manageBookBean.bookIdToDelete}" />
                </a4j:commandButton>
    <h:commandButton value="Delete" >
     <f:ajax event="click" listener="#{manageBookBean.deleteRow(book.idBook)}" render="@form" ></f:ajax>
     </h:commandButton>
    </rich:column>
    
    
    <!-- SCROLLER -->
    <f:facet name="footer">
 	<ui:include src="scrollPage.xhtml">
		<ui:param name="bean" value="#{manageBookBean}" />
	</ui:include>
    </f:facet>	 
</rich:dataTable>

<rich:popupPanel id="confirmPane" autosized="true">
	Are you sure you want to delete the row?
	<a4j:commandButton value="Cancel" onclick="#{rich:component('confirmPane')}.hide(); return false;" />
	<h:commandButton  value="Delete" > 
	<f:ajax event="click" listener="#{manageBookBean.deleteBook()}" onevent="#{rich:component('confirmPane')}.hide()" render="@form"></f:ajax>
	</h:commandButton>
</rich:popupPanel>
 			
        </h:form>
    </h:body>
</html>