<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">
    <h:head>
   
        <title>Manage Books</title>
         <h:outputStylesheet>
        
         body{
	overflow: visible;
         text-align: center; /* выравниваем все содержимое body по центру */
         }
         
         #content{
         	padding: 10px;
		padding-bottom: 50px; /* Height of the footer element */
         width:1200px;
         height: 100%;
         margin: 0 auto;
         }

        .even-row {
            background-color: #FCFFFE;
        }
 
        .odd-row {
            background-color: #ECF3FE;
        }
 
        .even-row:hover,
        .odd-row:hover {
            background-color: #FFEBDA;
        }
    </h:outputStylesheet>
    </h:head>
    <h:body>
    

    
    <div id="content">
   <a4j:jsFunction name="createBookURL" action="#{navigationAction.createBookURL()}" render="createBookPanel"></a4j:jsFunction> 
   <a4j:jsFunction name="hideCreateBook" action="#{navigationAction.hideIncludedURL()}" render="createBookPanel"></a4j:jsFunction> 
   
    
    
<h:form id="formManageBooks" prependId="false">
<ui:param name="bean" value="#{manageBookBean}" />

 <!--The sortable datatable-->
	<rich:dataTable   id="manageBookDataTable" value="#{bean.entities}" var="bookWrapper" rows="#{bean.rowsPerPage}" 
		rowClasses="odd-row, even-row"  binding="#{table}" styleClass="stable">
		
	<f:facet name="header">
		<ui:include src="inserts/manageBookHeader.xhtml" >
			<ui:param name="Name" value="MANAGE BOOK TABLE" />
		</ui:include>
	</f:facet>
		
<!-- checkBox column -->
	<ui:include src="inserts/selectColumn.xhtml" >
		<ui:param name="property" value="#{bookWrapper.selected}" />
	</ui:include>	

			
<!-- bookName Column -->		
 	<ui:include src="inserts/columnWithLink.xhtml" >
 		<ui:param name="id" value="bookNameColumn" />
 		<ui:param name="columnName" value="#{manageBookBean.entityConstantInstance.getConsant('bookName')}" />
 		<ui:param name="property" value="#{bookWrapper.book.bookName}" />
 		<ui:param name="outcomePage" value="bookDetails" />
 		<ui:param name="propertyId" value="#{bookWrapper.book.idBook}" />
 	</ui:include>
 	
<!-- Publisher column -->    
   <ui:include src="template/columnTemplate.xhtml">
		<ui:param name="id" value="publisherColumn" />
		<ui:param name="columnName" value="#{manageBookBean.entityConstantInstance.getConsant('publisher')}" />
		<ui:param name="property" value="#{bookWrapper.book.publisher}" />
   </ui:include>
   
 <!-- ISBN Column --> 
 	<ui:include src="template/columnTemplate.xhtml">
 		<ui:param name="id" value="isbnColumn" />
		<ui:param name="columnName" value="#{manageBookBean.entityConstantInstance.getConsant('isbn')}" />
		<ui:param name="property" value="#{bookWrapper.book.isbn}" />
   </ui:include>

<!-- yearPublished column -->
   <ui:include src="template/columnTemplate.xhtml">
  		<ui:param name="id" value="yearPublishedColumn" />
		<ui:param name="columnName" value="#{manageBookBean.entityConstantInstance.getConsant('yearPublished')}" />
		<ui:param name="property" value="#{bookWrapper.book.yearPublished}" />
   </ui:include>
   
 <!-- Rating Column -->
 	<ui:include src="template/columnTemplate.xhtml">
 		<ui:param name="id" value="ratingColumn" />
		<ui:param name="columnName" value="#{manageBookBean.entityConstantInstance.getConsant('rating')}" />
		<ui:param name="property" value="#{bookWrapper.book.rating}" />
   </ui:include>
   		
 <!-- Author Column -->
	<rich:column id="authorsColumn" sortBy="#{columnName}" sortOrder="#{manageBookBean.sortOrders[columnName]}" filterValue="#{manageBookBean.filterValues[property]}"
                 filterExpression="#{property}" filterType="custom" sortType="custom">
	<ui:param name="columnName" value="#{manageBookBean.entityConstantInstance.getConsant('authors')}" />
        <f:facet name="header">
        	<h:outputText value="#{columnName.UIView}" />
            <h:commandLink >
                #{manageBookBean.sortOrders[columnName]}
                <f:ajax event="click" listener="#{manageBookBean.toggleSort(columnName)}" execute="@form" render="@form"></f:ajax>
            </h:commandLink>
            <br />
            <h:inputText value="#{manageBookBean.filterValues[columnName]}" >
             <f:ajax event="change"></f:ajax>
            </h:inputText>
        </f:facet>
          <rich:list  value="#{bookWrapper.book.bookAuthors}" id="manageBookAuthors" var="author" >
        <h:link value="#{author.secondName} #{author.firstName}" outcome="authorDetail">
        	<f:param name="id" value="#{author.idauthor}"></f:param>
		</h:link>
    	</rich:list>
    </rich:column>
    
    <!-- DEL / EDIT -->
    <ui:include src="inserts/deleteAndEditColumn.xhtml" >
    	<ui:param name="propertyId" value="#{bookWrapper.book.idBook}" />
    </ui:include>
    
    
    <!-- SCROLLER -->
    <f:facet name="footer">
 	<ui:include src="dataTableFooter.xhtml">
	</ui:include>
    </f:facet>	 
    
</rich:dataTable>

	<rich:popupPanel id="confirmDelete" autosized="true">
		Are you sure you want to delete the row?
	<a4j:commandButton value="Cancel"
			onclick="#{rich:component('confirmDelete')}.hide(); return false;" />
		<h:commandButton value="Delete">
			<f:ajax event="click" listener="#{bean.deleteEntity()}"
				onevent="#{rich:component('confirmDelete')}.hide()" render="@form"></f:ajax>
		</h:commandButton>
	</rich:popupPanel>

</h:form>
        
 <rich:popupPanel id="createBook"  autosized="true" style="width:500px; height:150px" onbeforehide="hideCreateBook()">
	<f:facet name="controls">
	 <h:outputLink value="#" onclick="#{rich:component('createBook')}.hide(); return false;">
                X
            </h:outputLink>
	</f:facet>
	<h:panelGroup id="createBookPanel">
     <ui:include src="#{navigationAction.includedURL}" /> 
     </h:panelGroup> 
</rich:popupPanel>


</div>
    </h:body>
</html>