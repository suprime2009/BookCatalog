<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">
    <h:head>
        <title>Manage Books</title>
    </h:head>
    <h:body>
    <h:outputStylesheet>
        .even-row {
            background-color: #FCFFFE;
        }
 
        .odd-row {
            background-color: #ECF3FE;
        }
 
        .even-row:hover,
        .odd-row:hover {
            background-color: #FFEBDA;
        }
    </h:outputStylesheet>
    
   
   
<h:form id="formManageBooks" prependId="false">

		<ui:param name="bean" value="#{manageBookBean}" />

 <!--The sortable datatable-->
		<rich:dataTable   id="booksTable1" value="#{manageBookBean.entities}" var="bookWrapper" rows="#{manageBookBean.rowsPerPage}" 
		rowClasses="odd-row, even-row" style="width:1000" binding="#{table}" styleClass="stable">
		
		<f:facet name="header">
		
			<ui:include src="dataTableHeader.xhtml" >
				<ui:param name="Name" value="MANAGE BOOK TABLE" />
				<ui:param name="bean" value="#{manageBookBean}" />
			</ui:include>
		</f:facet>
		
<!-- checkBox column -->	
	<rich:column>
		<f:facet name="header">
		<h:selectBooleanCheckbox value="#{manageBookBean.selectAll}" >
		<f:ajax  event="change" listener="#{manageBookBean.selectAllAction()}" render="@form"></f:ajax>
		</h:selectBooleanCheckbox>
		</f:facet>
			<h:selectBooleanCheckbox  value="#{bookWrapper.selected}"> 
			<f:ajax ></f:ajax>
			</h:selectBooleanCheckbox>
	</rich:column>
			
<!-- bookName Column -->		

 	<rich:column id="bookNameColumn" sortBy="#{columnName}" sortOrder="#{manageBookBean.sortOrders[columnName]}" sortType="custom">
 	<ui:param name="columnName" value="#{manageBookBean.entityConstantInstance.getConsant('bookName')}" />
 	
        <f:facet name="header">
            <h:outputLabel value="#{columnName.UIView}" />
            <h:commandLink >
                #{manageBookBean.sortOrders[columnName]}
                <f:ajax event="click" listener="#{manageBookBean.toggleSort(columnName)}" execute="@form" render="@form"></f:ajax>
            </h:commandLink>
             <br />
            <h:inputText  value="#{manageBookBean.filterValues[columnName]}" >
            <f:ajax event="change" ></f:ajax>
            </h:inputText>
        </f:facet>
		<h:link value="#{bookWrapper.book.bookName}" outcome="bookDetails">
			<f:param name="id" value="#{bookWrapper.book.idBook}"></f:param>
		</h:link>
	</rich:column>
	
<!-- Publisher column -->    
   <ui:include src="regularColumn.xhtml">
		<ui:param name="bean" value="#{manageBookBean}" />
		<ui:param name="id" value="publisherColumn" />
		<ui:param name="columnName" value="#{manageBookBean.entityConstantInstance.getConsant('publisher')}" />
		<ui:param name="property" value="#{bookWrapper.book.publisher}" />
   </ui:include>
   
 <!-- ISBN Column --> 
 	<ui:include src="regularColumn.xhtml">
 	<ui:param name="id" value="isbnColumn" />
		<ui:param name="bean" value="#{manageBookBean}" />
		<ui:param name="columnName" value="#{manageBookBean.entityConstantInstance.getConsant('isbn')}" />
		<ui:param name="property" value="#{bookWrapper.book.isbn}" />
   </ui:include>

<!-- yearPublished column -->
   <ui:include src="regularColumn.xhtml">
   <ui:param name="id" value="yearPublishedColumn" />
		<ui:param name="bean" value="#{manageBookBean}" />
		<ui:param name="columnName" value="#{manageBookBean.entityConstantInstance.getConsant('yearPublished')}" />
		<ui:param name="property" value="#{bookWrapper.book.yearPublished}" />
   </ui:include>
   
 <!-- Rating Column -->
 	<ui:include src="regularColumn.xhtml">
 	<ui:param name="id" value="ratingColumn" />
		<ui:param name="bean" value="#{manageBookBean}" />
		<ui:param name="columnName" value="#{manageBookBean.entityConstantInstance.getConsant('rating')}" />
	<ui:param name="property" value="#{bookWrapper.book.rating}" />
   </ui:include>
   		
 <!-- Author Column -->
	<rich:column id="authorsColumn" sortBy="#{columnName}" sortOrder="#{manageBookBean.sortOrders[columnName]}" filterValue="#{manageBookBean.filterValues[property]}"
                 filterExpression="#{property}" filterType="custom" sortType="custom">
	<ui:param name="columnName" value="#{manageBookBean.entityConstantInstance.getConsant('authors')}" />
        <f:facet name="header">
        	<h:outputText value="#{columnName.UIView}" />
            <h:commandLink >
                #{manageBookBean.sortOrders[columnName]}
                <f:ajax event="click" listener="#{manageBookBean.toggleSort(columnName)}" execute="@form" render="@form"></f:ajax>
            </h:commandLink>
            <br />
            <h:inputText value="#{manageBookBean.filterValues[columnName]}" >
             <f:ajax event="change"></f:ajax>
            </h:inputText>
        </f:facet>
        <h:dataTable  value="#{bookWrapper.book.bookAuthors}" var="author">
         <h:link value="#{author.secondName} #{author.firstName}" outcome="authorDetail">
        	<f:param name="id" value="#{author.idauthor}"></f:param>
		</h:link>
        </h:dataTable>
          <rich:list  value="#{bookWrapper.book.bookAuthors}" id="manageBookAuthors" var="author" >
        <h:link value="#{author.secondName} #{author.firstName}" outcome="authorDetail">
        	<f:param name="id" value="#{author.idauthor}"></f:param>
		</h:link>
    	</rich:list>
    </rich:column>
    
    <!-- DEL / EDIT -->
    <rich:column>
    <f:facet name="header">
        	<h:outputText value="Edit / delete row" />
</f:facet>
<a4j:commandButton value="DEL" styleClass="no-decor" execute="@this" render="@none"
                    oncomplete="#{rich:component('confirmDelete')}.show()">
                    <a4j:param value="#{bookWrapper.book.idBook}" assignTo="#{manageBookBean.idEntityToDelete}" />
                </a4j:commandButton>
    <h:commandButton value="EDIT" >
     <f:ajax event="click" listener="#{manageBookBean.deleteEntity()}" render="@form" ></f:ajax>
     </h:commandButton>
    </rich:column>
    
    
    <!-- SCROLLER -->
    <f:facet name="footer">
 	<ui:include src="dataTableFooter.xhtml">
		<ui:param name="bean" value="#{manageBookBean}" />
	</ui:include>
    </f:facet>	 
    
</rich:dataTable>

<rich:popupPanel id="confirmDelete" autosized="true">
	Are you sure you want to delete the row?
	<a4j:commandButton value="Cancel" onclick="#{rich:component('confirmDelete')}.hide(); return false;" />
	<h:commandButton  value="Delete" > 
	<f:ajax event="click" listener="#{manageBookBean.deleteEntity()}" onevent="#{rich:component('confirmDelete')}.hide()" render="@form"></f:ajax>
	</h:commandButton>
</rich:popupPanel>
</h:form>
        
        
        <rich:popupPanel id="createBook" autosized="true" modal="true" style="width:600px; height:300px;">
 <f:facet name="controls">
            <h:outputLink value="#" onclick="#{rich:component('createBook')}.hide(); return false;">
                X
            </h:outputLink>
        </f:facet>
     <ui:include src="createBook.xhtml" />  

</rich:popupPanel>
    </h:body>
</html>